---
import Layout from '../layouts/Layout.astro';
---

<Layout title='Sliding Penguins'>
  <div class='game'>
    <canvas id='game-canvas'></canvas>
  </div>
</Layout>

<script>
  import { Application, Container, Sprite } from 'pixi.js';

  const app = new Application({
    view: document.getElementById('game-canvas') as HTMLCanvasElement,
    resolution: window.devicePixelRatio || 1,
    autoDensity: true,
    backgroundColor: '#000000',
    width: 420,
    height: 640,
  });

  let speed = 6;

  const player = Sprite.from('sliding-penguins/penguin.png');
  player.anchor.set(0.5);

  player.x = app.screen.width / 2;
  player.y = 80;
  player.scale.set(0.12);

  app.stage.addChild(player);

  const treeBorder = new Container();
  treeBorder.sortableChildren = true;
  treeBorder.interactiveChildren = false;

  for (let index = 0; index < app.screen.height / 60 + 1; index++) {
    const leftTree = Sprite.from('sliding-penguins/tree.png');
    leftTree.anchor.set(0.5);

    leftTree.x = Math.floor(Math.random() * 20);
    leftTree.y = index * 60;
    leftTree.scale.set(0.2);

    treeBorder.addChild(leftTree);

    const rightTree = Sprite.from('sliding-penguins/tree.png');
    rightTree.anchor.set(0.5);

    rightTree.x = Math.floor(Math.random() * 20) + app.screen.width - 20;
    rightTree.y = index * 60;
    rightTree.scale.set(0.2);

    treeBorder.addChild(rightTree);

    app.ticker.add((delta: number) => {
      leftTree.y -= speed * delta;
      rightTree.y -= speed * delta;

      if (leftTree.getBounds().bottom < 0) {
        const higherZIndex = treeBorder.children[treeBorder.children.length - 1].zIndex;

        leftTree.y = app.screen.height + 20;
        leftTree.zIndex = higherZIndex + 1;

        rightTree.y = app.screen.height + 20;
        rightTree.zIndex = higherZIndex + 1;
      }
    });
  }

  app.stage.addChild(treeBorder);
</script>
